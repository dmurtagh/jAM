/**
 * Jake is a JavaScript build tool for Node.js
 * http://howtonode.org/intro-to-jake
 * https://github.com/mde/jake
 *
 * To find out the available tasks for Jake run:
 * jake -T
 */
 var 
     fs = require('fs'),
     markdown = require('./assets/markdown'),
    // faker = require('./server/vendor/faker'),
    log = console.log,
    ENV = process.env.NODE_ENV || 'development',
    JK = {};

namespace('docs', function () {
    var exec = require('child_process').exec;

    desc('generate HTML & API documentation');

    task('docs', [], function () {
        console.log("* TODO generate javadoc?");
        console.log("* TODO generate jar/app?");

        // read readme.md
        fs.readFile(__dirname + '/../readme.md', 'utf8', function (err, readme) {
            if (err) throw err;

            // generate html file from markdown src
            fs.readFile(__dirname + '/index.tmpl', 'utf8', function (err, content) {
                
                var html = markdown.toHTML(readme);

                var finalContent = content.replace('<!-- placeholder, replaced with generated html from markdown -->', html);

                finalContent = '<!-- DO NOT EDIT THIS FILE!!! EDIT /readme.md instead! -->' + finalContent;
                fs.writeFile(__dirname + "/index.html", finalContent, 'utf8', function (err) {
                    if (err) throw err;

                    console.log("generated /docs/index.html");
                });
            });
        });    
    });
});